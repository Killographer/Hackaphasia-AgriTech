<!DOCTYPE html>
<html lang="en">
<title>FarmSense</title>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Crop Diversification Advisor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #2d5016;
            background: url('../Farmfeild.jpg') center/cover no-repeat fixed, #f8fafc;
            background-attachment: fixed;
        }
        
        main {
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(1, 70, 35, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(1, 70, 35, 0.2);
            color: #2d5016;
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d5016;
            font-size: 14px;
        }
        select, input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(125, 155, 60, 0.3);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            color: #2d5016;
            transition: all 0.3s ease;
        }
        select:focus, input:focus {
            outline: none;
            border-color: rgba(125, 155, 60, 0.6);
            box-shadow: 0 0 0 3px rgba(167, 201, 87, 0.2);
        }
        
        /* Specific dropdown styling */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232d5016' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
            cursor: pointer;
        }
        
        select:hover {
            border-color: rgba(125, 155, 60, 0.5);
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        /* Custom Dropdown Styling */
        .custom-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        
        .custom-dropdown-toggle {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(125, 155, 60, 0.3);
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            color: #2d5016;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
        }
        
        .custom-dropdown-toggle:hover {
            border-color: rgba(125, 155, 60, 0.5);
            background-color: rgba(255, 255, 255, 0.15);
        }
        
        .custom-dropdown-toggle:focus {
            outline: none;
            border-color: rgba(125, 155, 60, 0.6);
            box-shadow: 0 0 0 3px rgba(167, 201, 87, 0.2);
        }
        
        .custom-dropdown-arrow {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }
        
        .custom-dropdown.open .custom-dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .custom-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(125, 155, 60, 0.3);
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            margin-top: 4px;
        }
        
        .custom-dropdown.open .custom-dropdown-menu {
            display: block;
        }
        
        .custom-dropdown-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #2d5016;
            border-bottom: 1px solid rgba(125, 155, 60, 0.1);
        }
        
        .custom-dropdown-option:last-child {
            border-bottom: none;
        }
        
        .custom-dropdown-option:hover {
            background: rgba(125, 155, 60, 0.1);
        }
        
        .custom-dropdown-option.selected {
            background: rgba(125, 155, 60, 0.2);
            font-weight: 600;
        }
        
        .custom-dropdown.disabled .custom-dropdown-toggle {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        /* Specific width adjustments for input fields */
        #max-crops, #farm-area, #plot-length, #plot-width {
            max-width: 200px;
            width: 100%;
        }
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .col {
            flex: 1;
            min-width: 180px;
            max-width: 300px;
            box-sizing: border-box;
        }
        
        /* Responsive adjustments for form layout */
        @media (max-width: 1024px) {
            .col {
                min-width: 160px;
                max-width: 250px;
            }
        }
        
        @media (max-width: 768px) {
            .row {
                flex-direction: column;
                gap: 15px;
            }
            .col {
                min-width: 100%;
                flex: none;
                max-width: none;
            }
        }
        
        @media (max-width: 480px) {
            .row {
                gap: 10px;
            }
            .col {
                min-width: 100%;
            }
        }
        .btn {
            background: rgba(125, 155, 60, 0.28);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(125, 155, 60, 0.65);
            color: #1a3d0a;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(16, 24, 16, 0.16);
        }
        .btn:hover {
            background: rgba(125, 155, 60, 0.36);
            border-color: rgba(125, 155, 60, 0.75);
            box-shadow: 0 6px 18px rgba(16, 24, 16, 0.22);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(1px) scale(0.98);
        }
        .results {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .crop-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(125, 155, 60, 0.3);
            padding: 15px;
            margin: 10px 0;
            border-radius: 12px;
            border-left: 4px solid rgba(125, 155, 60, 0.8);
            transition: all 0.3s ease;
        }
        .crop-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .warning {
            background: rgba(255, 243, 205, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 234, 167, 0.6);
            color: #856404;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .success {
            background: rgba(212, 237, 218, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(195, 230, 203, 0.6);
            color: #155724;
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .language-selector select {
            background: transparent;
            border: none;
            color: #2d5016;
            font-weight: 600;
            padding: 5px;
        }
        .timeline {
            border-left: 3px solid rgba(125, 155, 60, 0.8);
            padding-left: 20px;
            margin: 20px 0;
        }
        .timeline-phase {
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(125, 155, 60, 0.3);
            border-radius: 12px;
            border-left: 4px solid rgba(125, 155, 60, 0.8);
            transition: all 0.3s ease;
        }
        .timeline-phase:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .phase-activities {
            margin-top: 10px;
        }
        .phase-activities ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .phase-activities li {
            margin: 5px 0;
            color: #555;
        }
        .crop-selection-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .crop-checkboxes {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(125, 155, 60, 0.3);
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 12px;
        }
        .layout-grid {
            display: grid;
            gap: 5px;
            margin: 20px 0;
        }
        .plot-item {
            border: 2px solid rgba(125, 155, 60, 0.4);
            padding: 10px;
            text-align: center;
            background: rgba(240, 248, 240, 0.8);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .plot-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .mode-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .mode-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 2px solid rgba(125, 155, 60, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .mode-card:hover {
            border-color: rgba(125, 155, 60, 0.6);
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        .mode-card.selected {
            border-color: rgba(125, 155, 60, 0.8);
            background: rgba(125, 155, 60, 0.15);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }
        .mode-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        .mode-card h3 {
            color: #2d5016;
            margin-bottom: 15px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        .mode-card p {
            color: #2d5016;
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .mode-card ul {
            text-align: left;
            margin: 20px 0;
            padding-left: 20px;
        }
        .mode-card li {
            margin: 8px 0;
            color: #555;
        }
        .mode-btn {
            background: rgba(125, 155, 60, 0.28);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(125, 155, 60, 0.65);
            color: #1a3d0a;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 14px rgba(16, 24, 16, 0.16);
        }
        .mode-btn:hover {
            background: rgba(125, 155, 60, 0.36);
            border-color: rgba(125, 155, 60, 0.75);
            transform: scale(1.05);
            box-shadow: 0 6px 18px rgba(16, 24, 16, 0.22);
        }
        .detection-status {
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .status-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        .detection-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        .auto-recommendations {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .auto-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
        }
        .detected-location-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .location-detail {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .location-detail:last-child {
            border-bottom: none;
        }
        .location-detail strong {
            color: #2d5016;
        }
        @media (max-width: 768px) {
            .mode-selection {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .detection-actions, .auto-actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <main>
    <div class="language-selector">
        <label for="language">Language:</label>
        <select id="language" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="hi">हिन्दी</option>
            <option value="kn">ಕನ್ನಡ</option>
        </select>
    </div>

    <div class="header">
        <h1 id="title" onclick="window.location.href='../Hackathon.html'" style="cursor: pointer;">AI-Powered Crop Diversification Advisor</h1>
    </div>

    <!-- Primary Interface Selection -->
    <div class="container" id="planning-mode-selection">
        <h2 id="mode-selection-title">Choose Your Planning Mode</h2>
        <div class="mode-selection">
            <div class="mode-card" onclick="selectPlanningMode('auto')">
                <div class="mode-icon">🌍</div>
                <h3 id="auto-mode-title">Auto-Detected Location Planning</h3>
                <p id="auto-mode-description">Let us automatically detect your location and provide personalized recommendations based on your area's agricultural data, soil conditions, and local market trends.</p>
                <ul id="auto-mode-features">
                    <li>Automatic location detection</li>
                    <li>Pre-filled soil and climate data</li>
                    <li>Local market price integration</li>
                    <li>Region-specific crop recommendations</li>
                </ul>
                <button class="mode-btn" id="auto-mode-btn">Start Auto Planning</button>
            </div>
            
            <div class="mode-card" onclick="selectPlanningMode('manual')">
                <div class="mode-icon">⚙️</div>
                <h3 id="manual-mode-title">Manual Option-Based Planning</h3>
                <p id="manual-mode-description">Manually input your farm details, soil conditions, and preferences to get customized crop diversification recommendations tailored to your specific requirements.</p>
                <ul id="manual-mode-features">
                    <li>Custom farm specifications</li>
                    <li>Manual soil condition input</li>
                    <li>Flexible crop selection</li>
                    <li>Detailed planning options</li>
                </ul>
                <button class="mode-btn" id="manual-mode-btn">Start Manual Planning</button>
            </div>
        </div>
    </div>

    <!-- Auto-Detection Interface -->
    <div class="container" id="auto-detection-interface" style="display: none;">
        <h2 id="auto-detection-title">Auto-Detection & Location-Based Planning</h2>
        <div class="auto-detection-content">
            <div class="detection-status" id="detection-status">
                <div class="status-icon">🔍</div>
                <h3 id="detection-title">Detecting Your Location...</h3>
                <p id="detection-description">We're analyzing your location to provide the best agricultural recommendations for your area.</p>
            </div>
            
            <div class="detection-actions">
                <button class="btn" onclick="startAutoDetection()" id="start-detection-btn">🌍 Detect My Location</button>
                <button class="btn" onclick="switchToManualMode()" id="switch-manual-btn" style="background: #6c757d;">Switch to Manual Mode</button>
            </div>
            
            <div id="auto-detection-results" style="display: none;">
                <div class="success">
                    <h4 id="detection-success-title">Location Detected Successfully!</h4>
                    <div id="detected-location-info"></div>
                </div>
                
                <div class="auto-recommendations" id="auto-recommendations">
                    <h3 id="auto-recommendations-title">Your Personalized Recommendations</h3>
                    <div id="auto-recommendations-content"></div>
                </div>
                
                <div class="auto-actions">
                    <button class="btn" onclick="acceptAutoRecommendations()" id="accept-auto-btn">Accept Recommendations</button>
                    <button class="btn" onclick="customizeAutoRecommendations()" id="customize-auto-btn" style="background: #ffc107; color: #000;">Customize Recommendations</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Planning Interface -->
    <div class="container" id="manual-planning-interface" style="display: none;">
        <h2 id="form-title">Farm Information</h2>
        
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label for="region" id="region-label">Region</label>
                    <select id="region">
                        <option value="" id="region-default">Please select region</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="district" id="district-label">District</label>
                    <select id="district" disabled>
                        <option value="" id="district-default">Please select district</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="season" id="season-label">Season</label>
                    <select id="season">
                        <option value="" id="season-default">Please select season</option>
                        <option value="Kharif">Kharif</option>
                        <option value="Rabi">Rabi</option>
                        <option value="Summer">Summer</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="max-crops" id="max-crops-label">Max Crops</label>
                    <input type="number" id="max-crops" value="5" min="3" max="8">
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label for="farm-area" id="farm-area-label">Farm Area (hectares)</label>
                    <input type="number" id="farm-area" value="5.0" min="0.1" max="1000" step="0.1">
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="plot-length" id="plot-length-label">Plot Length (meters)</label>
                    <input type="number" id="plot-length" value="100" min="10" max="1000" step="1">
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="plot-width" id="plot-width-label">Plot Width (meters)</label>
                    <input type="number" id="plot-width" value="50" min="10" max="1000" step="1">
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="growth-duration" id="growth-duration-label">Growth Duration (months)</label>
                    <select id="growth-duration">
                        <option value="" id="duration-default">Please select duration</option>
                        <option value="3">3 months (Short term)</option>
                        <option value="6">6 months (Medium term)</option>
                        <option value="9">9 months (Long term)</option>
                        <option value="12">12 months (Annual)</option>
                        <option value="24">24 months (Biennial)</option>
                    </select>
                </div>
            </div>
        </div>

        <h3 id="soil-title">Soil Condition Assessment</h3>
        <div class="row">
            <div class="col">
                <div class="form-group">
                    <label for="soil-texture" id="soil-texture-label">Soil Texture</label>
                    <select id="soil-texture">
                        <option value="" id="soil-texture-default">Please select soil texture</option>
                        <option value="Sandy">Sandy</option>
                        <option value="Loamy">Loamy</option>
                        <option value="Clayey">Clayey</option>
                        <option value="Silty">Silty</option>
                        <option value="Mixed">Mixed</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="soil-moisture" id="soil-moisture-label">Soil Moisture</label>
                    <select id="soil-moisture">
                        <option value="" id="soil-moisture-default">Please select soil moisture</option>
                        <option value="Dry">Dry</option>
                        <option value="Slightly Moist">Slightly Moist</option>
                        <option value="Moist">Moist</option>
                        <option value="Wet">Wet</option>
                        <option value="Waterlogged">Waterlogged</option>
                    </select>
                </div>
            </div>
            <div class="col">
                <div class="form-group">
                    <label for="soil-compaction" id="soil-compaction-label">Soil Compaction</label>
                    <select id="soil-compaction">
                        <option value="" id="soil-compaction-default">Please select soil compaction</option>
                        <option value="Loose/Airy">Loose/Airy</option>
                        <option value="Moderately Firm">Moderately Firm</option>
                        <option value="Firm">Firm</option>
                        <option value="Very Firm">Very Firm</option>
                        <option value="Hard">Hard</option>
                    </select>
                </div>
            </div>
        </div>

        <h3 id="crop-selection-title">Crop Selection & Planning</h3>
        <div class="form-group">
            <label for="selected-crops" id="selected-crops-label">Select your preferred crops from recommendations:</label>
            <div id="crop-selection-container" style="display: none;">
                <div id="crop-checkboxes"></div>
                <button type="button" class="btn" onclick="updateSelectedCrops()" id="update-crops-btn" style="background: #28a745; margin-top: 10px;">Update Selected Crops</button>
            </div>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn" onclick="getLocationAndAutoFill()" id="auto-detect-btn" style="background: #007bff; flex: 1;">🌍 Auto-Detect Location & Fill Data</button>
            <button class="btn" onclick="generateRecommendations()" id="generate-btn" style="flex: 1;">Generate Recommendations</button>
        </div>
    </div>

    <div id="results" class="container" style="display: none;">
        <h2 id="recommendations-title">Recommended Diversified Plan</h2>
        <div id="recommendations-list"></div>
        
        <h3 id="weather-title">Weather Forecast</h3>
        <div id="weather-forecast"></div>
        
        <h3 id="warnings-title">Weather Warnings</h3>
        <div id="weather-warnings"></div>
        
        <h3 id="storage-title">Storage Recommendations</h3>
        <div id="storage-advice"></div>
        
        <h3 id="conclusion-title">Conclusion & Recommendations</h3>
        <div id="conclusion"></div>
    </div>

    <script>
        // District data for each state
        const districtData = {
            "Karnataka": [
                "Bangalore Urban", "Bangalore Rural", "Mysore", "Belgaum", "Hubli-Dharwad", 
                "Mangalore", "Gulbarga", "Davanagere", "Bellary", "Bijapur", "Tumkur", 
                "Shimoga", "Raichur", "Bidar", "Hassan", "Chitradurga", "Kolar", "Mandya", 
                "Chikmagalur", "Udupi", "Chamrajanagar", "Dakshina Kannada", "Uttara Kannada", 
                "Koppal", "Gadag", "Yadgir", "Bagalkot", "Vijayapura", "Kalaburagi", "Ballari"
            ],
            "Maharashtra": [
                "Mumbai", "Pune", "Nagpur", "Nashik", "Aurangabad", "Solapur", "Amravati", 
                "Kolhapur", "Sangli", "Malegaon", "Jalgaon", "Akola", "Latur", "Ahmednagar", 
                "Chandrapur", "Parbhani", "Ichalkaranji", "Jalna", "Amalner", "Bhiwandi", 
                "Ulhasnagar", "Sangamner", "Dhule", "Ahmadnagar", "Miraj", "Latur", "Satara", 
                "Beed", "Yavatmal", "Kamptee", "Gondia", "Barshi", "Achalpur", "Osmanabad", 
                "Nanded", "Wardha", "Udgir", "Hinganghat", "Washim", "Amalner"
            ],
            "Tamil Nadu": [
                "Chennai", "Coimbatore", "Madurai", "Tiruchirappalli", "Salem", "Tirunelveli", 
                "Tiruppur", "Ranipet", "Erode", "Thoothukudi", "Dindigul", "Thanjavur", 
                "Vellore", "Kanchipuram", "Krishnagiri", "Namakkal", "Karur", "Tiruvallur", 
                "Tiruvannamalai", "Villupuram", "Cuddalore", "Pudukkottai", "Sivaganga", 
                "Ramanathapuram", "Virudhunagar", "Theni", "Dharmapuri", "Tiruppur", "Perambalur", 
                "Ariyalur", "Nagapattinam", "Tiruvarur", "Tiruchirappalli", "Karur", "Namakkal"
            ],
            "Andhra Pradesh": [
                "Visakhapatnam", "Vijayawada", "Guntur", "Nellore", "Kurnool", "Rajahmundry", 
                "Tirupati", "Kadapa", "Anantapur", "Chittoor", "Ongole", "Nandyal", "Eluru", 
                "Machilipatnam", "Tenali", "Proddatur", "Chilakaluripet", "Kadiri", "Dharmavaram", 
                "Gudivada", "Narasaraopet", "Tadipatri", "Mangalagiri", "Tadepalligudem", 
                "Srikakulam", "Vizianagaram", "Parvathipuram", "Bobbili", "Nuzvid", "Repalle", 
                "Palakollu", "Bhimavaram", "Nidadavole", "Tanuku", "Amalapuram", "Rajam", 
                "Srikalahasti", "Tirupati", "Chittoor", "Puttur", "Kadapa", "Proddatur", 
                "Nandyal", "Kurnool", "Adoni", "Nandikotkur", "Yemmiganur", "Dhone", "Banaganapalle"
            ]
        };

        // Agricultural database with location-based data
        const agriculturalData = {
            // Karnataka districts
            "Bangalore": {
                region: "Karnataka",
                district: "Bangalore Urban",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.2,
                drainage: "Well",
                organicMatter: 2.1,
                season: "Kharif",
                crops: ["Rice", "Maize", "Ragi", "Groundnut", "Sugarcane"]
            },
            "Mysore": {
                region: "Karnataka", 
                soilTexture: "Black Clay",
                soilMoisture: "Moist",
                soilCompaction: "Firm",
                ph: 7.1,
                drainage: "Moderate",
                organicMatter: 3.2,
                season: "Kharif",
                crops: ["Rice", "Sugarcane", "Maize", "Groundnut", "Sunflower"]
            },
            "Belgaum": {
                region: "Karnataka",
                soilTexture: "Red Loam",
                soilMoisture: "Slightly Moist", 
                soilCompaction: "Moderately Firm",
                ph: 6.8,
                drainage: "Well",
                organicMatter: 2.8,
                season: "Kharif",
                crops: ["Jowar", "Bajra", "Groundnut", "Cotton", "Sugarcane"]
            },
            "Hubli": {
                region: "Karnataka",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Dry",
                soilCompaction: "Loose/Airy",
                ph: 6.5,
                drainage: "Well",
                organicMatter: 1.9,
                season: "Kharif", 
                crops: ["Jowar", "Bajra", "Groundnut", "Cotton", "Maize"]
            },
            "Mangalore": {
                region: "Karnataka",
                soilTexture: "Laterite",
                soilMoisture: "Wet",
                soilCompaction: "Firm",
                ph: 5.8,
                drainage: "Poor",
                organicMatter: 4.1,
                season: "Kharif",
                crops: ["Rice", "Coconut", "Areca Nut", "Cashew", "Rubber"]
            },
            // Maharashtra districts
            "Pune": {
                region: "Maharashtra",
                soilTexture: "Black Cotton",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Firm",
                ph: 7.3,
                drainage: "Moderate",
                organicMatter: 2.5,
                season: "Kharif",
                crops: ["Sugarcane", "Cotton", "Soybean", "Maize", "Wheat"]
            },
            "Nagpur": {
                region: "Maharashtra",
                soilTexture: "Black Soil",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Firm",
                ph: 7.5,
                drainage: "Moderate",
                organicMatter: 2.8,
                season: "Kharif",
                crops: ["Cotton", "Soybean", "Wheat", "Chickpea", "Sugarcane"]
            },
            "Nashik": {
                region: "Maharashtra",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Slightly Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.9,
                drainage: "Well",
                organicMatter: 2.2,
                season: "Kharif",
                crops: ["Grapes", "Onion", "Tomato", "Sugarcane", "Wheat"]
            },
            // Tamil Nadu districts
            "Chennai": {
                region: "Tamil Nadu",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.4,
                drainage: "Well",
                organicMatter: 2.0,
                season: "Kharif",
                crops: ["Rice", "Sugarcane", "Groundnut", "Cotton", "Maize"]
            },
            "Coimbatore": {
                region: "Tamil Nadu",
                soilTexture: "Red Loam",
                soilMoisture: "Slightly Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.7,
                drainage: "Well",
                organicMatter: 2.3,
                season: "Kharif",
                crops: ["Cotton", "Sugarcane", "Maize", "Groundnut", "Rice"]
            },
            "Madurai": {
                region: "Tamil Nadu",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Dry",
                soilCompaction: "Loose/Airy",
                ph: 6.1,
                drainage: "Well",
                organicMatter: 1.8,
                season: "Kharif",
                crops: ["Cotton", "Chillies", "Groundnut", "Maize", "Rice"]
            },
            // Andhra Pradesh districts
            "Hyderabad": {
                region: "Andhra Pradesh",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Dry",
                soilCompaction: "Loose/Airy",
                ph: 6.3,
                drainage: "Well",
                organicMatter: 1.9,
                season: "Kharif",
                crops: ["Cotton", "Maize", "Groundnut", "Rice", "Sugarcane"]
            },
            "Vijayawada": {
                region: "Andhra Pradesh",
                soilTexture: "Black Clay",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Firm",
                ph: 7.2,
                drainage: "Moderate",
                organicMatter: 2.6,
                season: "Kharif",
                crops: ["Rice", "Sugarcane", "Cotton", "Maize", "Groundnut"]
            },
            "Visakhapatnam": {
                region: "Andhra Pradesh",
                soilTexture: "Red Loam",
                soilMoisture: "Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.0,
                drainage: "Well",
                organicMatter: 2.4,
                season: "Kharif",
                crops: ["Rice", "Sugarcane", "Cashew", "Coconut", "Groundnut"]
            }
        };

        // Weather API simulation (in real app, use actual weather API)
        const weatherAPI = {
            async getCurrentWeather(lat, lon) {
                // Simulate API call with realistic data based on location
                const season = this.getSeasonFromLocation(lat, lon);
                return {
                    temperature: this.getTemperatureForSeason(season),
                    humidity: Math.floor(Math.random() * 40) + 40,
                    rainfall: Math.random() < 0.3 ? Math.floor(Math.random() * 20) : 0,
                    windSpeed: Math.floor(Math.random() * 15) + 5
                };
            },
            
            getSeasonFromLocation(lat, lon) {
                // Simple season determination based on location and time
                const month = new Date().getMonth();
                if (lat < 20) { // Southern regions
                    return month >= 6 && month <= 10 ? "Kharif" : "Rabi";
                } else { // Northern regions
                    return month >= 6 && month <= 10 ? "Kharif" : "Rabi";
                }
            },
            
            getTemperatureForSeason(season) {
                if (season === "Kharif") {
                    return {
                        min: Math.floor(Math.random() * 10) + 20,
                        max: Math.floor(Math.random() * 10) + 30
                    };
                } else {
                    return {
                        min: Math.floor(Math.random() * 15) + 10,
                        max: Math.floor(Math.random() * 15) + 25
                    };
                }
            }
        };

        // Geolocation and auto-fill functionality
        let userLocation = null;
        let autoFilledData = null;

        function getLocationAndAutoFill() {
            if (navigator.geolocation) {
                showLoadingMessage("🌍 Detecting your location and fetching agricultural data...");
                
                navigator.geolocation.getCurrentPosition(
                    async function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        userLocation = { lat, lon };
                        
                        // Get location name from coordinates (simplified)
                        const locationName = await getLocationName(lat, lon);
                        
                        // Find closest agricultural data
                        const agriculturalInfo = findClosestAgriculturalData(lat, lon);
                        
                        if (agriculturalInfo) {
                            autoFilledData = agriculturalInfo;
                            autoFillForm(agriculturalInfo);
                            showSuccessMessage(`✅ Location detected: ${locationName}. Farm data loaded automatically!`);
                        } else {
                            showWarningMessage("⚠️ Location detected but no agricultural data available. Please fill manually.");
                        }
                    },
                    function(error) {
                        console.error("Geolocation error:", error);
                        showWarningMessage("⚠️ Could not detect location. Please fill the form manually.");
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                showWarningMessage("⚠️ Geolocation not supported. Please fill the form manually.");
            }
        }

        async function getLocationName(lat, lon) {
            // Simplified location name detection
            // In real app, use reverse geocoding API
            if (lat >= 12.8 && lat <= 13.2 && lon >= 77.4 && lon <= 77.8) {
                return "Bangalore, Karnataka";
            } else if (lat >= 12.2 && lat <= 12.6 && lon >= 76.5 && lon <= 76.9) {
                return "Mysore, Karnataka";
            } else if (lat >= 15.7 && lat <= 16.0 && lon >= 74.4 && lon <= 74.8) {
                return "Belgaum, Karnataka";
            } else if (lat >= 15.2 && lat <= 15.4 && lon >= 75.0 && lon <= 75.2) {
                return "Hubli, Karnataka";
            } else if (lat >= 12.8 && lat <= 13.0 && lon >= 74.7 && lon <= 75.0) {
                return "Mangalore, Karnataka";
            } else if (lat >= 18.4 && lat <= 18.7 && lon >= 73.7 && lon <= 74.0) {
                return "Pune, Maharashtra";
            } else if (lat >= 21.0 && lat <= 21.3 && lon >= 79.0 && lon <= 79.3) {
                return "Nagpur, Maharashtra";
            } else if (lat >= 19.9 && lat <= 20.1 && lon >= 73.6 && lon <= 73.8) {
                return "Nashik, Maharashtra";
            } else if (lat >= 13.0 && lat <= 13.2 && lon >= 80.1 && lon <= 80.3) {
                return "Chennai, Tamil Nadu";
            } else if (lat >= 11.0 && lat <= 11.1 && lon >= 76.9 && lon <= 77.0) {
                return "Coimbatore, Tamil Nadu";
            } else if (lat >= 9.8 && lat <= 10.0 && lon >= 78.0 && lon <= 78.2) {
                return "Madurai, Tamil Nadu";
            } else if (lat >= 17.3 && lat <= 17.5 && lon >= 78.3 && lon <= 78.5) {
                return "Hyderabad, Andhra Pradesh";
            } else if (lat >= 16.4 && lat <= 16.6 && lon >= 80.5 && lon <= 80.7) {
                return "Vijayawada, Andhra Pradesh";
            } else if (lat >= 17.6 && lat <= 17.8 && lon >= 83.2 && lon <= 83.4) {
                return "Visakhapatnam, Andhra Pradesh";
            } else {
                return "Unknown Location";
            }
        }

        function getLocationNameFromCoords(lat, lon) {
            // Synchronous version for auto-detection
            if (lat >= 12.8 && lat <= 13.2 && lon >= 77.4 && lon <= 77.8) {
                return "Bangalore, Karnataka";
            } else if (lat >= 12.2 && lat <= 12.6 && lon >= 76.5 && lon <= 76.9) {
                return "Mysore, Karnataka";
            } else if (lat >= 15.7 && lat <= 16.0 && lon >= 74.4 && lon <= 74.8) {
                return "Belgaum, Karnataka";
            } else if (lat >= 15.2 && lat <= 15.4 && lon >= 75.0 && lon <= 75.2) {
                return "Hubli, Karnataka";
            } else if (lat >= 12.8 && lat <= 13.0 && lon >= 74.7 && lon <= 75.0) {
                return "Mangalore, Karnataka";
            } else if (lat >= 18.4 && lat <= 18.7 && lon >= 73.7 && lon <= 74.0) {
                return "Pune, Maharashtra";
            } else if (lat >= 21.0 && lat <= 21.3 && lon >= 79.0 && lon <= 79.3) {
                return "Nagpur, Maharashtra";
            } else if (lat >= 19.9 && lat <= 20.1 && lon >= 73.6 && lon <= 73.8) {
                return "Nashik, Maharashtra";
            } else if (lat >= 13.0 && lat <= 13.2 && lon >= 80.1 && lon <= 80.3) {
                return "Chennai, Tamil Nadu";
            } else if (lat >= 11.0 && lat <= 11.1 && lon >= 76.9 && lon <= 77.0) {
                return "Coimbatore, Tamil Nadu";
            } else if (lat >= 9.8 && lat <= 10.0 && lon >= 78.0 && lon <= 78.2) {
                return "Madurai, Tamil Nadu";
            } else if (lat >= 17.3 && lat <= 17.5 && lon >= 78.3 && lon <= 78.5) {
                return "Hyderabad, Andhra Pradesh";
            } else if (lat >= 16.4 && lat <= 16.6 && lon >= 80.5 && lon <= 80.7) {
                return "Vijayawada, Andhra Pradesh";
            } else if (lat >= 17.6 && lat <= 17.8 && lon >= 83.2 && lon <= 83.4) {
                return "Visakhapatnam, Andhra Pradesh";
            } else {
                return "Unknown Location";
            }
        }

        function findClosestAgriculturalData(lat, lon) {
            // Find the closest agricultural data based on coordinates
            // This is a simplified version - in real app, use proper distance calculation
            
            if (lat >= 12.8 && lat <= 13.2 && lon >= 77.4 && lon <= 77.8) {
                return agriculturalData["Bangalore"];
            } else if (lat >= 12.2 && lat <= 12.6 && lon >= 76.5 && lon <= 76.9) {
                return agriculturalData["Mysore"];
            } else if (lat >= 15.7 && lat <= 16.0 && lon >= 74.4 && lon <= 74.8) {
                return agriculturalData["Belgaum"];
            } else if (lat >= 15.2 && lat <= 15.4 && lon >= 75.0 && lon <= 75.2) {
                return agriculturalData["Hubli"];
            } else if (lat >= 12.8 && lat <= 13.0 && lon >= 74.7 && lon <= 75.0) {
                return agriculturalData["Mangalore"];
            } else if (lat >= 18.4 && lat <= 18.7 && lon >= 73.7 && lon <= 74.0) {
                return agriculturalData["Pune"];
            } else if (lat >= 21.0 && lat <= 21.3 && lon >= 79.0 && lon <= 79.3) {
                return agriculturalData["Nagpur"];
            } else if (lat >= 19.9 && lat <= 20.1 && lon >= 73.6 && lon <= 73.8) {
                return agriculturalData["Nashik"];
            } else if (lat >= 13.0 && lat <= 13.2 && lon >= 80.1 && lon <= 80.3) {
                return agriculturalData["Chennai"];
            } else if (lat >= 11.0 && lat <= 11.1 && lon >= 76.9 && lon <= 77.0) {
                return agriculturalData["Coimbatore"];
            } else if (lat >= 9.8 && lat <= 10.0 && lon >= 78.0 && lon <= 78.2) {
                return agriculturalData["Madurai"];
            } else if (lat >= 17.3 && lat <= 17.5 && lon >= 78.3 && lon <= 78.5) {
                return agriculturalData["Hyderabad"];
            } else if (lat >= 16.4 && lat <= 16.6 && lon >= 80.5 && lon <= 80.7) {
                return agriculturalData["Vijayawada"];
            } else if (lat >= 17.6 && lat <= 17.8 && lon >= 83.2 && lon <= 83.4) {
                return agriculturalData["Visakhapatnam"];
            }
            
            // Default fallback data
            return {
                region: "Karnataka",
                soilTexture: "Red Sandy Loam",
                soilMoisture: "Moderately Moist",
                soilCompaction: "Moderately Firm",
                ph: 6.5,
                drainage: "Well",
                organicMatter: 2.0,
                season: "Kharif",
                crops: ["Rice", "Maize", "Groundnut", "Cotton", "Sugarcane"]
            };
        }

        function autoFillForm(data) {
            // Auto-fill form with detected data
            document.getElementById('region').value = data.region;
            document.getElementById('season').value = data.season;
            document.getElementById('soil-texture').value = data.soilTexture;
            document.getElementById('soil-moisture').value = data.soilMoisture;
            document.getElementById('soil-compaction').value = data.soilCompaction;
            
            // Show auto-filled data
            showAutoFilledData(data);
        }

        function showAutoFilledData(data) {
            const autoFillDiv = document.createElement('div');
            autoFillDiv.className = 'success';
            autoFillDiv.innerHTML = `
                <h4>🌍 Auto-Detected Farm Information</h4>
                <p><strong>Region:</strong> ${data.region}</p>
                <p><strong>Season:</strong> ${data.season}</p>
                <p><strong>Soil Texture:</strong> ${data.soilTexture}</p>
                <p><strong>Soil Moisture:</strong> ${data.soilMoisture}</p>
                <p><strong>Soil Compaction:</strong> ${data.soilCompaction}</p>
                <p><strong>pH Level:</strong> ${data.ph}</p>
                <p><strong>Drainage:</strong> ${data.drainage}</p>
                <p><strong>Organic Matter:</strong> ${data.organicMatter}%</p>
                <p><strong>Common Crops in Area:</strong> ${data.crops.join(', ')}</p>
            `;
            
            // Insert after the form
            const form = document.querySelector('.container');
            form.insertAdjacentElement('afterend', autoFillDiv);
        }

        function showLoadingMessage(message) {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'warning';
            loadingDiv.id = 'loading-message';
            loadingDiv.innerHTML = `<p>${message}</p>`;
            
            const form = document.querySelector('.container');
            form.insertAdjacentElement('afterend', loadingDiv);
        }

        function showSuccessMessage(message) {
            const loadingDiv = document.getElementById('loading-message');
            if (loadingDiv) {
                loadingDiv.className = 'success';
                loadingDiv.innerHTML = `<p>${message}</p>`;
            }
        }

        function showWarningMessage(message) {
            const loadingDiv = document.getElementById('loading-message');
            if (loadingDiv) {
                loadingDiv.className = 'warning';
                loadingDiv.innerHTML = `<p>${message}</p>`;
            }
        }

        function generateLocationBasedRecommendations(region, soilTexture, soilMoisture, maxCrops) {
            // Base recommendations based on region and soil conditions
            const baseRecommendations = {
                "Karnataka": [
                    { crop: "Rice", area: 30, yield: 4.2, revenue: 52000, soil: ["Red Sandy Loam", "Black Clay", "Laterite"] },
                    { crop: "Maize", area: 25, yield: 3.8, revenue: 38000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Groundnut", area: 20, yield: 1.8, revenue: 45000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Sugarcane", area: 15, yield: 80, revenue: 60000, soil: ["Black Clay", "Red Loam"] },
                    { crop: "Cotton", area: 10, yield: 2.5, revenue: 55000, soil: ["Red Sandy Loam", "Black Clay"] }
                ],
                "Maharashtra": [
                    { crop: "Sugarcane", area: 35, yield: 85, revenue: 65000, soil: ["Black Cotton", "Black Soil"] },
                    { crop: "Cotton", area: 25, yield: 2.8, revenue: 60000, soil: ["Black Cotton", "Black Soil"] },
                    { crop: "Soybean", area: 20, yield: 2.2, revenue: 35000, soil: ["Black Cotton", "Red Sandy Loam"] },
                    { crop: "Wheat", area: 15, yield: 3.2, revenue: 40000, soil: ["Black Cotton", "Red Sandy Loam"] },
                    { crop: "Maize", area: 5, yield: 4.0, revenue: 40000, soil: ["Red Sandy Loam"] }
                ],
                "Tamil Nadu": [
                    { crop: "Rice", area: 40, yield: 4.5, revenue: 55000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Sugarcane", area: 25, yield: 90, revenue: 70000, soil: ["Red Loam", "Red Sandy Loam"] },
                    { crop: "Cotton", area: 20, yield: 2.6, revenue: 58000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Groundnut", area: 10, yield: 2.0, revenue: 48000, soil: ["Red Sandy Loam"] },
                    { crop: "Maize", area: 5, yield: 4.2, revenue: 42000, soil: ["Red Loam"] }
                ],
                "Andhra Pradesh": [
                    { crop: "Rice", area: 35, yield: 4.3, revenue: 53000, soil: ["Black Clay", "Red Loam"] },
                    { crop: "Cotton", area: 25, yield: 2.7, revenue: 59000, soil: ["Red Sandy Loam", "Black Clay"] },
                    { crop: "Maize", area: 20, yield: 3.9, revenue: 39000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Groundnut", area: 15, yield: 1.9, revenue: 46000, soil: ["Red Sandy Loam", "Red Loam"] },
                    { crop: "Sugarcane", area: 5, yield: 85, revenue: 65000, soil: ["Black Clay"] }
                ]
            };

            let regionCrops = baseRecommendations[region] || baseRecommendations["Karnataka"];
            
            // Filter crops based on soil texture compatibility
            regionCrops = regionCrops.filter(crop => 
                crop.soil.includes(soilTexture) || crop.soil.length === 0
            );

            // Adjust based on soil moisture
            if (soilMoisture === "Wet" || soilMoisture === "Waterlogged") {
                regionCrops = regionCrops.filter(crop => 
                    ["Rice", "Sugarcane"].includes(crop.crop)
                );
            } else if (soilMoisture === "Dry") {
                regionCrops = regionCrops.filter(crop => 
                    ["Cotton", "Groundnut", "Maize"].includes(crop.crop)
                );
            }

            // Take only the requested number of crops
            return regionCrops.slice(0, maxCrops);
        }

        function generateRecommendationsFromAutoData(autoData, maxCrops) {
            // Use the auto-detected crop data for more accurate recommendations
            const cropData = {
                "Rice": { yield: 4.2, revenue: 52000 },
                "Maize": { yield: 3.8, revenue: 38000 },
                "Groundnut": { yield: 1.8, revenue: 45000 },
                "Sugarcane": { yield: 80, revenue: 60000 },
                "Cotton": { yield: 2.5, revenue: 55000 },
                "Soybean": { yield: 2.2, revenue: 35000 },
                "Wheat": { yield: 3.2, revenue: 40000 },
                "Jowar": { yield: 2.8, revenue: 32000 },
                "Bajra": { yield: 2.5, revenue: 30000 },
                "Ragi": { yield: 2.0, revenue: 35000 },
                "Sunflower": { yield: 1.5, revenue: 40000 },
                "Grapes": { yield: 15, revenue: 80000 },
                "Onion": { yield: 25, revenue: 45000 },
                "Tomato": { yield: 30, revenue: 50000 },
                "Chillies": { yield: 8, revenue: 60000 },
                "Coconut": { yield: 50, revenue: 70000 },
                "Areca Nut": { yield: 2, revenue: 120000 },
                "Cashew": { yield: 1.5, revenue: 80000 },
                "Rubber": { yield: 2, revenue: 100000 }
            };

            const recommendations = [];
            const availableCrops = autoData.crops || [];
            
            // Generate recommendations based on available crops in the area
            availableCrops.slice(0, maxCrops).forEach((crop, index) => {
                const data = cropData[crop] || { yield: 2.5, revenue: 40000 };
                const area = Math.floor(100 / maxCrops) + (index < 100 % maxCrops ? 1 : 0);
                
                recommendations.push({
                    crop: crop,
                    area: area,
                    yield: data.yield,
                    revenue: data.revenue
                });
            });

            return recommendations;
        }

        const translations = {
            en: {
                title: "AI-Powered Crop Diversification Advisor",
                "form-title": "Farm Information",
                "region-label": "Region",
                "district-label": "District",
                "season-label": "Season",
                "max-crops-label": "Max Crops",
                "farm-area-label": "Farm Area (hectares)",
                "plot-length-label": "Plot Length (meters)",
                "plot-width-label": "Plot Width (meters)",
                "growth-duration-label": "Growth Duration (months)",
                "soil-title": "Soil Condition Assessment",
                "soil-texture-label": "Soil Texture",
                "soil-moisture-label": "Soil Moisture",
                "soil-compaction-label": "Soil Compaction",
                "crop-selection-title": "Crop Selection & Planning",
                "selected-crops-label": "Select your preferred crops from recommendations:",
                "generate-btn": "Generate Recommendations",
                "recommendations-title": "Recommended Diversified Plan",
                "weather-title": "Weather Forecast",
                "warnings-title": "Weather Warnings",
                "storage-title": "Storage Recommendations",
                "conclusion-title": "Conclusion & Recommendations",
                "diversification-benefits-title": "Why Crop Diversification Matters:",
                "diversification-benefits-text": "Crop diversification is essential for sustainable farming success. Growing multiple crops instead of relying on a single crop provides numerous advantages: it reduces financial risk by spreading income sources across different markets and seasons, improves soil health through varied nutrient requirements and root systems, enhances pest and disease resistance by breaking monoculture cycles, increases overall farm productivity through complementary growing patterns, and provides better resilience against climate variability and market fluctuations. This strategic approach ensures more stable income, healthier ecosystems, and long-term agricultural sustainability.",
                "farm-layout-title": "Detailed Farm Field Layout",
                "market-tracking-title": "Local Market Tracking",
                "farming-plan-title": "Systematic Farming Plan",
                "mode-selection-title": "Choose Your Planning Mode",
                "auto-mode-title": "Auto-Detected Location Planning",
                "auto-mode-description": "Let us automatically detect your location and provide personalized recommendations based on your area's agricultural data, soil conditions, and local market trends.",
                "manual-mode-title": "Manual Option-Based Planning",
                "manual-mode-description": "Manually input your farm details, soil conditions, and preferences to get customized crop diversification recommendations tailored to your specific requirements.",
                "auto-detection-title": "Auto-Detection & Location-Based Planning",
                "detection-title": "Detecting Your Location...",
                "detection-description": "We're analyzing your location to provide the best agricultural recommendations for your area.",
                "detection-success-title": "Location Detected Successfully!",
                "auto-recommendations-title": "Your Personalized Recommendations"
            },
            hi: {
                title: "AI-संचालित फसल विविधीकरण सलाहकार",
                "form-title": "खेत की जानकारी",
                "region-label": "क्षेत्र",
                "district-label": "जिला",
                "season-label": "मौसम",
                "max-crops-label": "अधिकतम फसलें",
                "farm-area-label": "खेत का क्षेत्रफल (हेक्टेयर)",
                "plot-length-label": "प्लॉट की लंबाई (मीटर)",
                "plot-width-label": "प्लॉट की चौड़ाई (मीटर)",
                "growth-duration-label": "विकास अवधि (महीने)",
                "soil-title": "मिट्टी की स्थिति का आकलन",
                "soil-texture-label": "मिट्टी की बनावट",
                "soil-moisture-label": "मिट्टी की नमी",
                "soil-compaction-label": "मिट्टी का संघनन",
                "crop-selection-title": "फसल चयन और योजना",
                "selected-crops-label": "सिफारिशों से अपनी पसंदीदा फसलें चुनें:",
                "generate-btn": "सिफारिशें उत्पन्न करें",
                "recommendations-title": "अनुशंसित विविधीकृत योजना",
                "weather-title": "मौसम पूर्वानुमान",
                "warnings-title": "मौसम चेतावनियां",
                "storage-title": "भंडारण सलाह",
                "conclusion-title": "निष्कर्ष और सिफारिशें",
                "diversification-benefits-title": "फसल विविधीकरण क्यों महत्वपूर्ण है:",
                "diversification-benefits-text": "फसल विविधीकरण सतत कृषि सफलता के लिए आवश्यक है। एक फसल पर निर्भर रहने के बजाय कई फसलें उगाने से कई लाभ मिलते हैं: यह विभिन्न बाजारों और मौसमों में आय स्रोतों को फैलाकर वित्तीय जोखिम को कम करता है, विविध पोषक तत्व आवश्यकताओं और जड़ प्रणालियों के माध्यम से मिट्टी के स्वास्थ्य में सुधार करता है, एकल फसल चक्रों को तोड़कर कीट और रोग प्रतिरोध को बढ़ाता है, पूरक विकास पैटर्न के माध्यम से समग्र खेत उत्पादकता को बढ़ाता है, और जलवायु परिवर्तनशीलता और बाजार उतार-चढ़ाव के खिलाफ बेहतर लचीलापन प्रदान करता है। यह रणनीतिक दृष्टिकोण अधिक स्थिर आय, स्वस्थ पारिस्थितिकी तंत्र और दीर्घकालिक कृषि स्थिरता सुनिश्चित करता है।",
                "farm-layout-title": "विस्तृत खेत लेआउट",
                "market-tracking-title": "स्थानीय बाजार ट्रैकिंग",
                "farming-plan-title": "व्यवस्थित कृषि योजना",
                "mode-selection-title": "अपना प्लानिंग मोड चुनें",
                "auto-mode-title": "ऑटो-डिटेक्टेड लोकेशन प्लानिंग",
                "auto-mode-description": "हमें अपना स्थान स्वचालित रूप से डिटेक्ट करने दें और आपके क्षेत्र के कृषि डेटा, मिट्टी की स्थिति और स्थानीय बाजार के रुझानों के आधार पर व्यक्तिगत सिफारिशें प्रदान करें।",
                "manual-mode-title": "मैनुअल विकल्प-आधारित प्लानिंग",
                "manual-mode-description": "अपनी विशिष्ट आवश्यकताओं के अनुरूप अनुकूलित फसल विविधीकरण सिफारिशें प्राप्त करने के लिए अपने खेत के विवरण, मिट्टी की स्थिति और प्राथमिकताओं को मैन्युअल रूप से इनपुट करें।",
                "auto-detection-title": "ऑटो-डिटेक्शन और लोकेशन-आधारित प्लानिंग",
                "detection-title": "आपका स्थान डिटेक्ट कर रहे हैं...",
                "detection-description": "हम आपके क्षेत्र के लिए सबसे अच्छी कृषि सिफारिशें प्रदान करने के लिए आपके स्थान का विश्लेषण कर रहे हैं।",
                "detection-success-title": "स्थान सफलतापूर्वक डिटेक्ट किया गया!",
                "auto-recommendations-title": "आपकी व्यक्तिगत सिफारिशें"
            },
            kn: {
                title: "AI-ಶಕ್ತಿಯುತ ಬೆಳೆ ವೈವಿಧ್ಯೀಕರಣ ಸಲಹೆಗಾರ",
                "form-title": "ಕೃಷಿ ಮಾಹಿತಿ",
                "region-label": "ಪ್ರದೇಶ",
                "district-label": "ಜಿಲ್ಲೆ",
                "season-label": "ಋತು",
                "max-crops-label": "ಗರಿಷ್ಠ ಬೆಳೆಗಳು",
                "farm-area-label": "ಕೃಷಿ ಭೂಮಿ (ಹೆಕ್ಟೇರ್)",
                "plot-length-label": "ಪ್ಲಾಟ್ ಉದ್ದ (ಮೀಟರ್)",
                "plot-width-label": "ಪ್ಲಾಟ್ ಅಗಲ (ಮೀಟರ್)",
                "growth-duration-label": "ಬೆಳವಣಿಗೆ ಅವಧಿ (ತಿಂಗಳು)",
                "soil-title": "ಮಣ್ಣಿನ ಸ್ಥಿತಿ ಮೌಲ್ಯಮಾಪನ",
                "soil-texture-label": "ಮಣ್ಣಿನ ರಚನೆ",
                "soil-moisture-label": "ಮಣ್ಣಿನ ತೇವಾಂಶ",
                "soil-compaction-label": "ಮಣ್ಣಿನ ಸಂಕೋಚನ",
                "crop-selection-title": "ಬೆಳೆ ಆಯ್ಕೆ ಮತ್ತು ಯೋಜನೆ",
                "selected-crops-label": "ಶಿಫಾರಸುಗಳಿಂದ ನಿಮ್ಮ ಆದ್ಯತೆಯ ಬೆಳೆಗಳನ್ನು ಆಯ್ಕೆಮಾಡಿ:",
                "generate-btn": "ಶಿಫಾರಸುಗಳನ್ನು ಉತ್ಪಾದಿಸಿ",
                "recommendations-title": "ಶಿಫಾರಸು ಮಾಡಿದ ವೈವಿಧ್ಯೀಕೃತ ಯೋಜನೆ",
                "weather-title": "ಹವಾಮಾನ ಮುನ್ಸೂಚನೆ",
                "warnings-title": "ಹವಾಮಾನ ಎಚ್ಚರಿಕೆಗಳು",
                "storage-title": "ಸಂಗ್ರಹಣೆ ಸಲಹೆ",
                "conclusion-title": "ತೀರ್ಮಾನ ಮತ್ತು ಶಿಫಾರಸುಗಳು",
                "diversification-benefits-title": "ಬೆಳೆ ವೈವಿಧ್ಯತೆ ಏಕೆ ಮುಖ್ಯ:",
                "diversification-benefits-text": "ಬೆಳೆ ವೈವಿಧ್ಯತೆ ಸುಸ್ಥಿರ ಕೃಷಿ ಯಶಸ್ಸಿಗೆ ಅತ್ಯಗತ್ಯ. ಒಂದು ಬೆಳೆಯನ್ನು ಅವಲಂಬಿಸುವ ಬದಲು ಅನೇಕ ಬೆಳೆಗಳನ್ನು ಬೆಳೆಯುವುದರಿಂದ ಹಲವಾರು ಪ್ರಯೋಜನಗಳಿವೆ: ಇದು ವಿಭಿನ್ನ ಮಾರುಕಟ್ಟೆಗಳು ಮತ್ತು ಋತುಗಳಲ್ಲಿ ಆದಾಯ ಮೂಲಗಳನ್ನು ಹರಡುವ ಮೂಲಕ ಹಣಕಾಸು ಅಪಾಯವನ್ನು ಕಡಿಮೆ ಮಾಡುತ್ತದೆ, ವೈವಿಧ್ಯಮಯ ಪೋಷಕಾಂಶ ಅಗತ್ಯಗಳು ಮತ್ತು ಬೇರು ವ್ಯವಸ್ಥೆಗಳ ಮೂಲಕ ಮಣ್ಣಿನ ಆರೋಗ್ಯವನ್ನು ಸುಧಾರಿಸುತ್ತದೆ, ಏಕ ಬೆಳೆ ಚಕ್ರಗಳನ್ನು ಮುರಿಯುವ ಮೂಲಕ ಕೀಟ ಮತ್ತು ರೋಗ ಪ್ರತಿರೋಧವನ್ನು ಹೆಚ್ಚಿಸುತ್ತದೆ, ಪೂರಕ ಬೆಳವಣಿಗೆ ಮಾದರಿಗಳ ಮೂಲಕ ಒಟ್ಟಾರೆ ಕೃಷಿ ಉತ್ಪಾದಕತೆಯನ್ನು ಹೆಚ್ಚಿಸುತ್ತದೆ, ಮತ್ತು ಹವಾಮಾನ ವ್ಯತ್ಯಾಸ ಮತ್ತು ಮಾರುಕಟ್ಟೆ ಏರಿಳಿತಗಳ ವಿರುದ್ಧ ಉತ್ತಮ ಸಹಿಷ್ಣುತೆಯನ್ನು ಒದಗಿಸುತ್ತದೆ. ಈ ಕಾರ್ಯತಂತ್ರದ ವಿಧಾನವು ಹೆಚ್ಚು ಸ್ಥಿರ ಆದಾಯ, ಆರೋಗ್ಯಕರ ಪರಿಸರ ವ್ಯವಸ್ಥೆಗಳು ಮತ್ತು ದೀರ್ಘಕಾಲಿಕ ಕೃಷಿ ಸುಸ್ಥಿರತೆಯನ್ನು ಖಚಿತಪಡಿಸುತ್ತದೆ.",
                "farm-layout-title": "ವಿವರವಾದ ಕೃಷಿ ಕ್ಷೇತ್ರ ವಿನ್ಯಾಸ",
                "market-tracking-title": "ಸ್ಥಳೀಯ ಮಾರುಕಟ್ಟೆ ಟ್ರ್ಯಾಕಿಂಗ್",
                "farming-plan-title": "ವ್ಯವಸ್ಥಿತ ಕೃಷಿ ಯೋಜನೆ",
                "mode-selection-title": "ನಿಮ್ಮ ಯೋಜನಾ ಮೋಡ್ ಅನ್ನು ಆಯ್ಕೆಮಾಡಿ",
                "auto-mode-title": "ಸ್ವಯಂ-ಪತ್ತೆ ಸ್ಥಳ ಯೋಜನೆ",
                "auto-mode-description": "ನಿಮ್ಮ ಸ್ಥಳವನ್ನು ಸ್ವಯಂಚಾಲಿತವಾಗಿ ಪತ್ತೆ ಮಾಡಲು ನಮಗೆ ಅನುಮತಿಸಿ ಮತ್ತು ನಿಮ್ಮ ಪ್ರದೇಶದ ಕೃಷಿ ಡೇಟಾ, ಮಣ್ಣಿನ ಪರಿಸ್ಥಿತಿಗಳು ಮತ್ತು ಸ್ಥಳೀಯ ಮಾರುಕಟ್ಟೆ ಪ್ರವೃತ್ತಿಗಳ ಆಧಾರದ ಮೇಲೆ ವೈಯಕ್ತಿಕ ಶಿಫಾರಸುಗಳನ್ನು ಒದಗಿಸಿ.",
                "manual-mode-title": "ಕೈಯಾರೆ ಆಯ್ಕೆ-ಆಧಾರಿತ ಯೋಜನೆ",
                "manual-mode-description": "ನಿಮ್ಮ ನಿರ್ದಿಷ್ಟ ಅವಶ್ಯಕತೆಗಳಿಗೆ ಹೊಂದಿಕೊಳ್ಳುವ ಕಸ್ಟಮೈಜ್ಡ್ ಬೆಳೆ ವೈವಿಧ್ಯೀಕರಣ ಶಿಫಾರಸುಗಳನ್ನು ಪಡೆಯಲು ನಿಮ್ಮ ಕೃಷಿ ವಿವರಗಳು, ಮಣ್ಣಿನ ಪರಿಸ್ಥಿತಿಗಳು ಮತ್ತು ಆದ್ಯತೆಗಳನ್ನು ಕೈಯಾರೆ ಇನ್ಪುಟ್ ಮಾಡಿ.",
                "auto-detection-title": "ಸ್ವಯಂ-ಪತ್ತೆ ಮತ್ತು ಸ್ಥಳ-ಆಧಾರಿತ ಯೋಜನೆ",
                "detection-title": "ನಿಮ್ಮ ಸ್ಥಳವನ್ನು ಪತ್ತೆ ಮಾಡುತ್ತಿದ್ದೇವೆ...",
                "detection-description": "ನಿಮ್ಮ ಪ್ರದೇಶಕ್ಕೆ ಅತ್ಯುತ್ತಮ ಕೃಷಿ ಶಿಫಾರಸುಗಳನ್ನು ಒದಗಿಸಲು ನಾವು ನಿಮ್ಮ ಸ್ಥಳವನ್ನು ವಿಶ್ಲೇಷಿಸುತ್ತಿದ್ದೇವೆ.",
                "detection-success-title": "ಸ್ಥಳವನ್ನು ಯಶಸ್ವಿಯಾಗಿ ಪತ್ತೆ ಮಾಡಲಾಗಿದೆ!",
                "auto-recommendations-title": "ನಿಮ್ಮ ವೈಯಕ್ತಿಕ ಶಿಫಾರಸುಗಳು"
            }
        };

        // Global variables for selected crops and recommendations
        let currentRecommendations = [];
        let selectedCrops = [];
        let currentPlanningMode = null;
        let detectedLocationData = null;

        // Planning mode selection functions
        function selectPlanningMode(mode) {
            currentPlanningMode = mode;
            
            // Hide all interfaces
            document.getElementById('planning-mode-selection').style.display = 'none';
            document.getElementById('auto-detection-interface').style.display = 'none';
            document.getElementById('manual-planning-interface').style.display = 'none';
            
            if (mode === 'auto') {
                document.getElementById('auto-detection-interface').style.display = 'block';
                updateAutoDetectionInterface();
            } else if (mode === 'manual') {
                document.getElementById('manual-planning-interface').style.display = 'block';
            }
        }

        function switchToManualMode() {
            selectPlanningMode('manual');
        }

        function startAutoDetection() {
            const statusDiv = document.getElementById('detection-status');
            const statusIcon = statusDiv.querySelector('.status-icon');
            const statusTitle = document.getElementById('detection-title');
            const statusDescription = document.getElementById('detection-description');
            
            // Show loading state
            statusIcon.textContent = '🔄';
            statusTitle.textContent = 'Detecting Your Location...';
            statusDescription.textContent = 'Please allow location access and wait while we analyze your area...';
            
            // Simulate detection process
            setTimeout(() => {
                performLocationDetection();
            }, 2000);
        }

        function performLocationDetection() {
            // Check if we have stored location data from Hackathon.html
            const storedLocation = localStorage.getItem('detectedLocation');
            if (storedLocation) {
                try {
                    const locationData = JSON.parse(storedLocation);
                    const lat = locationData.latitude;
                    const lon = locationData.longitude;
                    
                    // Find closest agricultural data
                    const agriculturalInfo = findClosestAgriculturalData(lat, lon);
                    const locationName = getLocationNameFromCoords(lat, lon);
                    
                    if (agriculturalInfo) {
                        detectedLocationData = {
                            coordinates: { lat, lon },
                            locationName: locationName,
                            agriculturalData: agriculturalInfo
                        };
                        
                        showDetectionResults(locationName, agriculturalInfo);
                        
                        // Clear the stored location data
                        localStorage.removeItem('detectedLocation');
                    } else {
                        showDetectionError();
                    }
                    return;
                } catch (error) {
                    console.error("Error parsing stored location data:", error);
                }
            }
            
            // Fallback to normal geolocation if no stored data
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Find closest agricultural data
                        const agriculturalInfo = findClosestAgriculturalData(lat, lon);
                        const locationName = getLocationNameFromCoords(lat, lon);
                        
                        if (agriculturalInfo) {
                            detectedLocationData = {
                                coordinates: { lat, lon },
                                locationName: locationName,
                                agriculturalData: agriculturalInfo
                            };
                            
                            showDetectionResults(locationName, agriculturalInfo);
                        } else {
                            showDetectionError();
                        }
                    },
                    function(error) {
                        console.error("Geolocation error:", error);
                        showDetectionError();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                showDetectionError();
            }
        }

        function showDetectionResults(locationName, agriculturalData) {
            const statusDiv = document.getElementById('detection-status');
            const statusIcon = statusDiv.querySelector('.status-icon');
            const statusTitle = document.getElementById('detection-title');
            const statusDescription = document.getElementById('detection-description');
            
            // Update status
            statusIcon.textContent = '✅';
            statusTitle.textContent = 'Location Detected Successfully!';
            statusDescription.textContent = `We found agricultural data for ${locationName}`;
            
            // Show results
            document.getElementById('auto-detection-results').style.display = 'block';
            
            // Display location info
            const locationInfo = document.getElementById('detected-location-info');
            locationInfo.innerHTML = `
                <div class="location-detail">
                    <strong>Location:</strong>
                    <span>${locationName}</span>
                </div>
                <div class="location-detail">
                    <strong>Region:</strong>
                    <span>${agriculturalData.region}</span>
                </div>
                <div class="location-detail">
                    <strong>Soil Texture:</strong>
                    <span>${agriculturalData.soilTexture}</span>
                </div>
                <div class="location-detail">
                    <strong>Soil Moisture:</strong>
                    <span>${agriculturalData.soilMoisture}</span>
                </div>
                <div class="location-detail">
                    <strong>Soil Compaction:</strong>
                    <span>${agriculturalData.soilCompaction}</span>
                </div>
                <div class="location-detail">
                    <strong>pH Level:</strong>
                    <span>${agriculturalData.ph}</span>
                </div>
                <div class="location-detail">
                    <strong>Common Crops:</strong>
                    <span>${agriculturalData.crops.join(', ')}</span>
                </div>
            `;
            
            // Generate auto recommendations
            generateAutoRecommendations(agriculturalData);
        }

        function showDetectionError() {
            const statusDiv = document.getElementById('detection-status');
            const statusIcon = statusDiv.querySelector('.status-icon');
            const statusTitle = document.getElementById('detection-title');
            const statusDescription = document.getElementById('detection-description');
            
            statusIcon.textContent = '❌';
            statusTitle.textContent = 'Location Detection Failed';
            statusDescription.textContent = 'Unable to detect your location. Please try manual mode or check your location permissions.';
        }

        function generateAutoRecommendations(agriculturalData) {
            const recommendationsContent = document.getElementById('auto-recommendations-content');
            
            // Generate recommendations based on detected data
            const recommendations = generateRecommendationsFromAutoData(agriculturalData, 5);
            
            let recommendationsHTML = '<div class="recommendations-grid">';
            recommendations.forEach((rec, index) => {
                recommendationsHTML += `
                    <div class="crop-card">
                        <h4>${index + 1}. ${rec.crop}</h4>
                        <p><strong>Area:</strong> ${rec.area}%</p>
                        <p><strong>Expected Yield:</strong> ${rec.yield} t/ha</p>
                        <p><strong>Expected Revenue:</strong> ₹${rec.revenue.toLocaleString()}/ha</p>
                    </div>
                `;
            });
            recommendationsHTML += '</div>';
            
            recommendationsContent.innerHTML = recommendationsHTML;
        }

        function acceptAutoRecommendations() {
            if (detectedLocationData) {
                // Auto-fill the manual form with detected data
                const agriculturalData = detectedLocationData.agriculturalData;
                
                // Set form values
                document.getElementById('region').value = agriculturalData.region;
                document.getElementById('season').value = agriculturalData.season;
                document.getElementById('soil-texture').value = agriculturalData.soilTexture;
                document.getElementById('soil-moisture').value = agriculturalData.soilMoisture;
                document.getElementById('soil-compaction').value = agriculturalData.soilCompaction;
                
                // Trigger district update
                handleRegionChange();
                
                // Switch to manual mode with pre-filled data
                selectPlanningMode('manual');
                
                // Show success message
                showSuccessMessage('✅ Location data has been applied to your farm planning form!');
            }
        }

        function customizeAutoRecommendations() {
            // Switch to manual mode for customization
            acceptAutoRecommendations();
        }

        function updateAutoDetectionInterface() {
            const lang = document.getElementById('language').value;
            const t = translations[lang];
            
            document.getElementById('auto-detection-title').textContent = t['auto-detection-title'];
            document.getElementById('detection-title').textContent = t['detection-title'];
            document.getElementById('detection-description').textContent = t['detection-description'];
            document.getElementById('detection-success-title').textContent = t['detection-success-title'];
            document.getElementById('auto-recommendations-title').textContent = t['auto-recommendations-title'];
        }

        function changeLanguage() {
            const lang = document.getElementById('language').value;
            const t = translations[lang];
            
            document.getElementById('title').textContent = t.title;
            document.getElementById('mode-selection-title').textContent = t['mode-selection-title'];
            document.getElementById('auto-mode-title').textContent = t['auto-mode-title'];
            document.getElementById('auto-mode-description').textContent = t['auto-mode-description'];
            document.getElementById('manual-mode-title').textContent = t['manual-mode-title'];
            document.getElementById('manual-mode-description').textContent = t['manual-mode-description'];
            
            if (document.getElementById('form-title')) {
            document.getElementById('form-title').textContent = t['form-title'];
            }
            if (document.getElementById('region-label')) {
            document.getElementById('region-label').textContent = t['region-label'];
            }
            if (document.getElementById('district-label')) {
                document.getElementById('district-label').textContent = t['district-label'];
            }
            if (document.getElementById('season-label')) {
            document.getElementById('season-label').textContent = t['season-label'];
            }
            if (document.getElementById('max-crops-label')) {
            document.getElementById('max-crops-label').textContent = t['max-crops-label'];
            }
            if (document.getElementById('farm-area-label')) {
            document.getElementById('farm-area-label').textContent = t['farm-area-label'];
            }
            if (document.getElementById('plot-length-label')) {
                document.getElementById('plot-length-label').textContent = t['plot-length-label'];
            }
            if (document.getElementById('plot-width-label')) {
                document.getElementById('plot-width-label').textContent = t['plot-width-label'];
            }
            if (document.getElementById('growth-duration-label')) {
                document.getElementById('growth-duration-label').textContent = t['growth-duration-label'];
            }
            if (document.getElementById('soil-title')) {
            document.getElementById('soil-title').textContent = t['soil-title'];
            }
            if (document.getElementById('soil-texture-label')) {
            document.getElementById('soil-texture-label').textContent = t['soil-texture-label'];
            }
            if (document.getElementById('soil-moisture-label')) {
            document.getElementById('soil-moisture-label').textContent = t['soil-moisture-label'];
            }
            if (document.getElementById('soil-compaction-label')) {
            document.getElementById('soil-compaction-label').textContent = t['soil-compaction-label'];
            }
            if (document.getElementById('crop-selection-title')) {
                document.getElementById('crop-selection-title').textContent = t['crop-selection-title'];
            }
            if (document.getElementById('selected-crops-label')) {
                document.getElementById('selected-crops-label').textContent = t['selected-crops-label'];
            }
            if (document.getElementById('generate-btn')) {
            document.getElementById('generate-btn').textContent = t['generate-btn'];
            }
            
            // Update auto-detection interface if visible
            if (currentPlanningMode === 'auto') {
                updateAutoDetectionInterface();
            }
            
            // Update default options
            updateDefaultOptions(t);
        }

        function updateDefaultOptions(t) {
            const lang = document.getElementById('language').value;
            const pleaseSelect = lang === 'hi' ? 'कृपया चुनें' : lang === 'kn' ? 'ದಯವಿಟ್ಟು ಆಯ್ಕೆಮಾಡಿ' : 'Please select';
            
            // Update default options
            if (document.getElementById('region-default')) {
                document.getElementById('region-default').textContent = t['region-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('district-default')) {
                document.getElementById('district-default').textContent = t['district-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('season-default')) {
                document.getElementById('season-default').textContent = t['season-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('soil-texture-default')) {
                document.getElementById('soil-texture-default').textContent = t['soil-texture-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('soil-moisture-default')) {
                document.getElementById('soil-moisture-default').textContent = t['soil-moisture-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('soil-compaction-default')) {
                document.getElementById('soil-compaction-default').textContent = t['soil-compaction-label'] + ' - ' + pleaseSelect;
            }
            if (document.getElementById('duration-default')) {
                document.getElementById('duration-default').textContent = t['growth-duration-label'] + ' - ' + pleaseSelect;
            }
            
            // Update all dropdown options
            updateDropdownTranslations(t);
        }

        function updateDropdownTranslations(t) {
            const lang = document.getElementById('language').value;
            
            // Update region options
            const regionSelect = document.getElementById('region');
            if (regionSelect) {
                const regionOptions = regionSelect.querySelectorAll('option');
                regionOptions.forEach(option => {
                    if (option.value === 'Karnataka') {
                        option.textContent = lang === 'hi' ? 'कर्नाटक' : lang === 'kn' ? 'ಕರ್ನಾಟಕ' : 'Karnataka';
                    } else if (option.value === 'Maharashtra') {
                        option.textContent = lang === 'hi' ? 'महाराष्ट्र' : lang === 'kn' ? 'ಮಹಾರಾಷ್ಟ್ರ' : 'Maharashtra';
                    } else if (option.value === 'Tamil Nadu') {
                        option.textContent = lang === 'hi' ? 'तमिलनाडु' : lang === 'kn' ? 'ತಮಿಳುನಾಡು' : 'Tamil Nadu';
                    } else if (option.value === 'Andhra Pradesh') {
                        option.textContent = lang === 'hi' ? 'आंध्र प्रदेश' : lang === 'kn' ? 'ಆಂಧ್ರ ಪ್ರದೇಶ' : 'Andhra Pradesh';
                    }
                });
            }
            
            // Update season options
            const seasonSelect = document.getElementById('season');
            if (seasonSelect) {
                const seasonOptions = seasonSelect.querySelectorAll('option');
                seasonOptions.forEach(option => {
                    if (option.value === 'Kharif') {
                        option.textContent = lang === 'hi' ? 'खरीफ' : lang === 'kn' ? 'ಖರೀಫ್' : 'Kharif';
                    } else if (option.value === 'Rabi') {
                        option.textContent = lang === 'hi' ? 'रबी' : lang === 'kn' ? 'ರಬಿ' : 'Rabi';
                    } else if (option.value === 'Summer') {
                        option.textContent = lang === 'hi' ? 'गर्मी' : lang === 'kn' ? 'ಬೇಸಿಗೆ' : 'Summer';
                    }
                });
            }
            
            // Update soil texture options
            const soilTextureSelect = document.getElementById('soil-texture');
            if (soilTextureSelect) {
                const soilTextureOptions = soilTextureSelect.querySelectorAll('option');
                soilTextureOptions.forEach(option => {
                    if (option.value === 'Sandy') {
                        option.textContent = lang === 'hi' ? 'बालू' : lang === 'kn' ? 'ಮರಳು' : 'Sandy';
                    } else if (option.value === 'Loamy') {
                        option.textContent = lang === 'hi' ? 'दोमट' : lang === 'kn' ? 'ದೋಮಟ್' : 'Loamy';
                    } else if (option.value === 'Clayey') {
                        option.textContent = lang === 'hi' ? 'चिकनी मिट्टी' : lang === 'kn' ? 'ಜೇಡಿಮಣ್ಣು' : 'Clayey';
                    } else if (option.value === 'Silty') {
                        option.textContent = lang === 'hi' ? 'गाद' : lang === 'kn' ? 'ಗಂಧಕ' : 'Silty';
                    } else if (option.value === 'Mixed') {
                        option.textContent = lang === 'hi' ? 'मिश्रित' : lang === 'kn' ? 'ಮಿಶ್ರ' : 'Mixed';
                    }
                });
            }
            
            // Update soil moisture options
            const soilMoistureSelect = document.getElementById('soil-moisture');
            if (soilMoistureSelect) {
                const soilMoistureOptions = soilMoistureSelect.querySelectorAll('option');
                soilMoistureOptions.forEach(option => {
                    if (option.value === 'Dry') {
                        option.textContent = lang === 'hi' ? 'सूखा' : lang === 'kn' ? 'ಒಣ' : 'Dry';
                    } else if (option.value === 'Slightly Moist') {
                        option.textContent = lang === 'hi' ? 'थोड़ा नम' : lang === 'kn' ? 'ಸ್ವಲ್ಪ ತೇವ' : 'Slightly Moist';
                    } else if (option.value === 'Moist') {
                        option.textContent = lang === 'hi' ? 'नम' : lang === 'kn' ? 'ತೇವ' : 'Moist';
                    } else if (option.value === 'Wet') {
                        option.textContent = lang === 'hi' ? 'गीला' : lang === 'kn' ? 'ನೆನೆ' : 'Wet';
                    } else if (option.value === 'Waterlogged') {
                        option.textContent = lang === 'hi' ? 'जलभराव' : lang === 'kn' ? 'ನೀರಿನಲ್ಲಿ ಮುಳುಗಿದ' : 'Waterlogged';
                    }
                });
            }
            
            // Update soil compaction options
            const soilCompactionSelect = document.getElementById('soil-compaction');
            if (soilCompactionSelect) {
                const soilCompactionOptions = soilCompactionSelect.querySelectorAll('option');
                soilCompactionOptions.forEach(option => {
                    if (option.value === 'Loose/Airy') {
                        option.textContent = lang === 'hi' ? 'ढीला/हवादार' : lang === 'kn' ? 'ಅನಿಲ/ಗಾಳಿ' : 'Loose/Airy';
                    } else if (option.value === 'Moderately Firm') {
                        option.textContent = lang === 'hi' ? 'मध्यम दृढ़' : lang === 'kn' ? 'ಮಧ್ಯಮ ದೃಢ' : 'Moderately Firm';
                    } else if (option.value === 'Firm') {
                        option.textContent = lang === 'hi' ? 'दृढ़' : lang === 'kn' ? 'ದೃಢ' : 'Firm';
                    } else if (option.value === 'Very Firm') {
                        option.textContent = lang === 'hi' ? 'बहुत दृढ़' : lang === 'kn' ? 'ಬಹಳ ದೃಢ' : 'Very Firm';
                    } else if (option.value === 'Hard') {
                        option.textContent = lang === 'hi' ? 'कठोर' : lang === 'kn' ? 'ಕಠಿಣ' : 'Hard';
                    }
                });
            }
            
            // Update growth duration options
            const growthDurationSelect = document.getElementById('growth-duration');
            if (growthDurationSelect) {
                const growthDurationOptions = growthDurationSelect.querySelectorAll('option');
                growthDurationOptions.forEach(option => {
                    if (option.value === '3') {
                        option.textContent = lang === 'hi' ? '3 महीने (अल्पकालिक)' : lang === 'kn' ? '3 ತಿಂಗಳು (ಅಲ್ಪಕಾಲಿಕ)' : '3 months (Short term)';
                    } else if (option.value === '6') {
                        option.textContent = lang === 'hi' ? '6 महीने (मध्यम अवधि)' : lang === 'kn' ? '6 ತಿಂಗಳು (ಮಧ್ಯಮ ಅವಧಿ)' : '6 months (Medium term)';
                    } else if (option.value === '9') {
                        option.textContent = lang === 'hi' ? '9 महीने (दीर्घकालिक)' : lang === 'kn' ? '9 ತಿಂಗಳು (ದೀರ್ಘಕಾಲಿಕ)' : '9 months (Long term)';
                    } else if (option.value === '12') {
                        option.textContent = lang === 'hi' ? '12 महीने (वार्षिक)' : lang === 'kn' ? '12 ತಿಂಗಳು (ವಾರ್ಷಿಕ)' : '12 months (Annual)';
                    } else if (option.value === '24') {
                        option.textContent = lang === 'hi' ? '24 महीने (द्विवार्षिक)' : lang === 'kn' ? '24 ತಿಂಗಳು (ದ್ವಿವಾರ್ಷಿಕ)' : '24 months (Biennial)';
                    }
                });
            }
        }

        // Handle region change to populate districts
        function handleRegionChange() {
            const region = document.getElementById('region').value;
            const districtSelect = document.getElementById('district');
            const lang = document.getElementById('language').value;
            const t = translations[lang];
            const pleaseSelect = lang === 'hi' ? 'कृपया चुनें' : lang === 'kn' ? 'ದಯವಿಟ್ಟು ಆಯ್ಕೆಮಾಡಿ' : 'Please select';
            
            // Clear existing options
            districtSelect.innerHTML = `<option value="" id="district-default">${t['district-label']} - ${pleaseSelect}</option>`;
            
            if (region && districtData[region]) {
                districtSelect.disabled = false;
                districtData[region].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district; // Keep district names in English for consistency
                    districtSelect.appendChild(option);
                });
            } else {
                districtSelect.disabled = true;
            }
        }

        // Update selected crops from checkboxes
        function updateSelectedCrops() {
            const checkboxes = document.querySelectorAll('#crop-checkboxes input[type="checkbox"]:checked');
            selectedCrops = Array.from(checkboxes).map(cb => cb.value);
            
            if (selectedCrops.length > 0) {
                // Save farmer data to database
                const farmerData = {
                    name: 'Farmer User',
                    region: document.getElementById('region').value,
                    district: document.getElementById('district').value,
                    farmArea: parseFloat(document.getElementById('farm-area').value),
                    plotLength: parseFloat(document.getElementById('plot-length').value),
                    plotWidth: parseFloat(document.getElementById('plot-width').value),
                    soilTexture: document.getElementById('soil-texture').value,
                    soilMoisture: document.getElementById('soil-moisture').value,
                    soilCompaction: document.getElementById('soil-compaction').value
                };
                
                const farmerId = farmerDatabase.addFarmer(farmerData);
                
                // Save crop selections
                selectedCrops.forEach(crop => {
                    const cropData = {
                        cropName: crop,
                        areaPercentage: 100 / selectedCrops.length, // Equal distribution
                        expectedYield: 3.0, // Default value
                        expectedRevenue: 40000, // Default value
                        growthDuration: parseInt(document.getElementById('growth-duration').value),
                        season: document.getElementById('season').value
                    };
                    farmerDatabase.addCropSelection(farmerId, cropData);
                });
                
                generateDetailedFarmLayout();
                generateFarmingPlan();
                generateMarketTracking();
            }
        }

        // Generate detailed farm layout with plot dimensions
        function generateDetailedFarmLayout() {
            const plotLength = parseFloat(document.getElementById('plot-length').value) || 100;
            const plotWidth = parseFloat(document.getElementById('plot-width').value) || 50;
            const farmArea = parseFloat(document.getElementById('farm-area').value) || 5.0;
            
            // Calculate how many plots fit in the farm area
            const plotArea = (plotLength * plotWidth) / 10000; // Convert to hectares
            const maxPlots = Math.floor(farmArea / plotArea);
            
            // Create detailed layout visualization
            const layoutDiv = document.getElementById('detailed-layout');
            if (!layoutDiv) {
                const newDiv = document.createElement('div');
                newDiv.id = 'detailed-layout';
                newDiv.className = 'container';
                newDiv.innerHTML = `
                    <h2 id="farm-layout-title">Detailed Farm Field Layout</h2>
                    <div id="layout-visualization"></div>
                    <div id="layout-stats"></div>
                `;
                document.getElementById('results').appendChild(newDiv);
            }
            
            // Generate layout visualization
            generateLayoutVisualization(plotLength, plotWidth, maxPlots);
        }

        function generateLayoutVisualization(length, width, maxPlots) {
            const container = document.getElementById('layout-visualization');
            const stats = document.getElementById('layout-stats');
            
            // Calculate grid dimensions
            const plotsPerRow = Math.ceil(Math.sqrt(maxPlots));
            const totalRows = Math.ceil(maxPlots / plotsPerRow);
            
            let layoutHTML = `
                <div style="display: grid; grid-template-columns: repeat(${plotsPerRow}, 1fr); gap: 5px; max-width: 800px; margin: 20px auto;">
            `;
            
            for (let i = 0; i < maxPlots; i++) {
                const row = Math.floor(i / plotsPerRow);
                const col = i % plotsPerRow;
                const cropIndex = i % selectedCrops.length;
                const crop = selectedCrops[cropIndex] || 'Unassigned';
                
                layoutHTML += `
                    <div style="border: 2px solid #333; padding: 10px; text-align: center; background: #f0f8f0; min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                        <strong>Plot ${i + 1}</strong>
                        <div style="font-size: 12px; color: #666;">${crop}</div>
                        <div style="font-size: 10px; color: #888;">${length}m × ${width}m</div>
                    </div>
                `;
            }
            
            layoutHTML += '</div>';
            container.innerHTML = layoutHTML;
            
            // Display statistics
            const totalArea = (length * width * maxPlots) / 10000; // Convert to hectares
            stats.innerHTML = `
                <div class="success">
                    <h4>Farm Layout Statistics</h4>
                    <p><strong>Total Plots:</strong> ${maxPlots}</p>
                    <p><strong>Plot Dimensions:</strong> ${length}m × ${width}m each</p>
                    <p><strong>Total Area Covered:</strong> ${totalArea.toFixed(2)} hectares</p>
                    <p><strong>Grid Layout:</strong> ${totalRows} rows × ${plotsPerRow} columns</p>
                </div>
            `;
        }

        // Generate systematic farming plan
        function generateFarmingPlan() {
            const growthDuration = parseInt(document.getElementById('growth-duration').value) || 6;
            const season = document.getElementById('season').value;
            
            const planDiv = document.getElementById('farming-plan');
            if (!planDiv) {
                const newDiv = document.createElement('div');
                newDiv.id = 'farming-plan';
                newDiv.className = 'container';
                newDiv.innerHTML = `
                    <h2 id="farming-plan-title">Systematic Farming Plan</h2>
                    <div id="plan-timeline"></div>
                    <div id="plan-details"></div>
                `;
                document.getElementById('results').appendChild(newDiv);
            }
            
            generatePlanTimeline(growthDuration, season);
        }

        function generatePlanTimeline(duration, season) {
            const timeline = document.getElementById('plan-timeline');
            const details = document.getElementById('plan-details');
            
            let timelineHTML = '<div class="timeline">';
            const phases = Math.ceil(duration / 3); // 3-month phases
            
            for (let phase = 1; phase <= phases; phase++) {
                const startMonth = (phase - 1) * 3 + 1;
                const endMonth = Math.min(phase * 3, duration);
                
                timelineHTML += `
                    <div class="timeline-phase">
                        <h4>Phase ${phase} (Months ${startMonth}-${endMonth})</h4>
                        <div class="phase-activities">
                            ${generatePhaseActivities(phase, selectedCrops, season)}
                        </div>
                    </div>
                `;
            }
            
            timelineHTML += '</div>';
            timeline.innerHTML = timelineHTML;
            
            // Generate detailed plan
            details.innerHTML = generateDetailedPlan(selectedCrops, duration, season);
        }

        function generatePhaseActivities(phase, crops, season) {
            const activities = {
                1: ['Land preparation', 'Soil testing', 'Seed procurement', 'Irrigation setup'],
                2: ['Planting', 'Initial fertilization', 'Pest monitoring', 'Water management'],
                3: ['Growth monitoring', 'Weed control', 'Disease prevention', 'Nutrient management'],
                4: ['Harvest preparation', 'Storage setup', 'Market research', 'Quality assessment']
            };
            
            const phaseActivities = activities[phase] || ['Maintenance', 'Monitoring', 'Adjustments'];
            return phaseActivities.map(activity => `<li>${activity}</li>`).join('');
        }

        function generateDetailedPlan(crops, duration, season) {
            return `
                <div class="success">
                    <h4>Detailed Farming Plan for ${duration} months</h4>
                    <p><strong>Season:</strong> ${season}</p>
                    <p><strong>Selected Crops:</strong> ${crops.join(', ')}</p>
                    <p><strong>Key Focus Areas:</strong></p>
                    <ul>
                        <li>Soil health maintenance</li>
                        <li>Water management optimization</li>
                        <li>Pest and disease control</li>
                        <li>Market timing and pricing</li>
                        <li>Quality improvement techniques</li>
                    </ul>
                </div>
            `;
        }

        // Generate market tracking section
        function generateMarketTracking() {
            const region = document.getElementById('region').value;
            const district = document.getElementById('district').value;
            
            const marketDiv = document.getElementById('market-tracking');
            if (!marketDiv) {
                const newDiv = document.createElement('div');
                newDiv.id = 'market-tracking';
                newDiv.className = 'container';
                newDiv.innerHTML = `
                    <h2 id="market-tracking-title">Local Market Tracking</h2>
                    <div id="market-data"></div>
                    <div id="price-trends"></div>
                `;
                document.getElementById('results').appendChild(newDiv);
            }
            
            generateMarketData(region, district);
        }

        function generateMarketData(region, district) {
            const marketData = document.getElementById('market-data');
            const priceTrends = document.getElementById('price-trends');
            
            // Get market data from database
            const marketPrices = {};
            selectedCrops.forEach(crop => {
                const trends = farmerDatabase.getMarketTrends(region, district, crop);
                marketPrices[crop] = {
                    current: trends.latestPrice || Math.floor(Math.random() * 50000) + 20000,
                    trend: trends.trend,
                    change: trends.priceChange,
                    average: trends.averagePrice
                };
            });
            
            let marketHTML = `
                <div class="success">
                    <h4>Current Market Prices - ${district}, ${region}</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            `;
            
            Object.entries(marketPrices).forEach(([crop, data]) => {
                const trendIcon = data.trend === 'up' ? '📈' : data.trend === 'down' ? '📉' : '➡️';
                const trendColor = data.trend === 'up' ? '#28a745' : data.trend === 'down' ? '#dc3545' : '#6c757d';
                
                marketHTML += `
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: white;">
                        <h5>${crop}</h5>
                        <p><strong>Current Price:</strong> ₹${data.current.toLocaleString()}/ton</p>
                        <p><strong>Average Price:</strong> ₹${data.average.toLocaleString()}/ton</p>
                        <p style="color: ${trendColor};">${trendIcon} ${data.change.toFixed(1)}%</p>
                    </div>
                `;
            });
            
            marketHTML += '</div></div>';
            marketData.innerHTML = marketHTML;
            
            // Generate price trends analysis
            const totalChange = Object.values(marketPrices).reduce((sum, data) => sum + data.change, 0) / selectedCrops.length;
            const overallTrend = totalChange > 2 ? 'positive' : totalChange < -2 ? 'negative' : 'stable';
            
            priceTrends.innerHTML = `
                <div class="warning">
                    <h4>Market Trend Analysis</h4>
                    <p><strong>Overall Market Trend:</strong> ${overallTrend} (${totalChange.toFixed(1)}% average change)</p>
                    <p>Market prices are updated daily. Monitor local mandis and government price portals for real-time data.</p>
                    <p><strong>Recommendation:</strong> Consider selling when prices are 15-20% above average for maximum profit.</p>
                    <p><strong>Best Selling Time:</strong> ${overallTrend === 'positive' ? 'Consider selling soon as prices are rising' : overallTrend === 'negative' ? 'Wait for better prices or consider storage' : 'Prices are stable, monitor for opportunities'}</p>
                </div>
            `;
        }

        function generateRecommendations() {
            const region = document.getElementById('region').value;
            const season = document.getElementById('season').value;
            const maxCrops = parseInt(document.getElementById('max-crops').value);
            const farmArea = parseFloat(document.getElementById('farm-area').value);
            const soilTexture = document.getElementById('soil-texture').value;
            const soilMoisture = document.getElementById('soil-moisture').value;
            const soilCompaction = document.getElementById('soil-compaction').value;

            // Validate required fields
            if (!region || !season || !soilTexture || !soilMoisture || !soilCompaction) {
                alert('Please fill in all required fields before generating recommendations.');
                return;
            }

            // Generate recommendations based on location and soil data
            let recommendations = generateLocationBasedRecommendations(region, soilTexture, soilMoisture, maxCrops);
            
            // If we have auto-filled data, use it for more accurate recommendations
            if (autoFilledData && autoFilledData.crops) {
                recommendations = generateRecommendationsFromAutoData(autoFilledData, maxCrops);
            }

            // Store recommendations globally
            currentRecommendations = recommendations;

            // Display recommendations
            const resultsDiv = document.getElementById('results');
            const recommendationsList = document.getElementById('recommendations-list');
            
            recommendationsList.innerHTML = '';
            recommendations.forEach((rec, index) => {
                const actualArea = (rec.area / 100) * farmArea;
                const totalRevenue = (rec.revenue * actualArea).toFixed(0);
                
                const cropCard = document.createElement('div');
                cropCard.className = 'crop-card';
                cropCard.innerHTML = `
                    <h4>${index + 1}. ${rec.crop}</h4>
                    <p><strong>Area:</strong> ${rec.area}% (${actualArea.toFixed(2)} hectares)</p>
                    <p><strong>Expected Yield:</strong> ${rec.yield} t/ha</p>
                    <p><strong>Expected Revenue:</strong> ₹${rec.revenue.toLocaleString()}/ha</p>
                    <p><strong>Total Revenue:</strong> ₹${totalRevenue}</p>
                `;
                recommendationsList.appendChild(cropCard);
            });

            // Show crop selection interface
            showCropSelectionInterface(recommendations);

            // Generate weather forecast
            generateWeatherForecast();
            
            // Generate storage advice
            generateStorageAdvice();
            
            // Generate conclusion
            generateConclusion();

            resultsDiv.style.display = 'block';
        }

        function showCropSelectionInterface(recommendations) {
            const container = document.getElementById('crop-selection-container');
            const checkboxes = document.getElementById('crop-checkboxes');
            
            container.style.display = 'block';
            checkboxes.innerHTML = '';
            
            recommendations.forEach((rec, index) => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.style.marginBottom = '10px';
                checkboxDiv.innerHTML = `
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" value="${rec.crop}" style="margin-right: 10px;">
                        <span><strong>${rec.crop}</strong> - ${rec.area}% area, ₹${rec.revenue.toLocaleString()}/ha</span>
                    </label>
                `;
                checkboxes.appendChild(checkboxDiv);
            });
        }

        function generateWeatherForecast() {
            const weatherDiv = document.getElementById('weather-forecast');
            const warningsDiv = document.getElementById('weather-warnings');
            
            // Sample weather data
            const weatherData = [
                { date: '2024-01-15', minTemp: 18, maxTemp: 28, humidity: 65, rainfall: 0, windSpeed: 12 },
                { date: '2024-01-16', minTemp: 20, maxTemp: 32, humidity: 70, rainfall: 5, windSpeed: 8 },
                { date: '2024-01-17', minTemp: 22, maxTemp: 35, humidity: 75, rainfall: 0, windSpeed: 15 },
                { date: '2024-01-18', minTemp: 19, maxTemp: 30, humidity: 60, rainfall: 18, windSpeed: 20 },
                { date: '2024-01-19', minTemp: 17, maxTemp: 26, humidity: 55, rainfall: 0, windSpeed: 10 },
                { date: '2024-01-20', minTemp: 16, maxTemp: 24, humidity: 50, rainfall: 0, windSpeed: 6 },
                { date: '2024-01-21', minTemp: 18, maxTemp: 27, humidity: 58, rainfall: 0, windSpeed: 9 }
            ];

            let weatherHTML = '<table style="width: 100%; border-collapse: collapse;"><tr><th>Date</th><th>Min Temp (°C)</th><th>Max Temp (°C)</th><th>Humidity (%)</th><th>Rainfall (mm)</th><th>Wind Speed (km/h)</th></tr>';
            
            weatherData.forEach(day => {
                weatherHTML += `<tr><td>${day.date}</td><td>${day.minTemp}</td><td>${day.maxTemp}</td><td>${day.humidity}</td><td>${day.rainfall}</td><td>${day.windSpeed}</td></tr>`;
            });
            
            weatherHTML += '</table>';
            weatherDiv.innerHTML = weatherHTML;

            // Generate warnings
            let warnings = [];
            weatherData.forEach(day => {
                if (day.rainfall > 15) {
                    warnings.push(`🌧️ Heavy rainfall expected on ${day.date} - Consider protecting crops`);
                }
                if (day.maxTemp > 35) {
                    warnings.push(`🌡️ High temperature warning on ${day.date} - Ensure adequate irrigation`);
                }
                if (day.windSpeed > 15) {
                    warnings.push(`💨 Strong winds expected on ${day.date} - Check crop support structures`);
                }
            });

            if (warnings.length > 0) {
                warningsDiv.innerHTML = warnings.map(warning => `<div class="warning">${warning}</div>`).join('');
            } else {
                warningsDiv.innerHTML = '<div class="success">No significant weather warnings for the next 7 days</div>';
            }
        }

        function generateStorageAdvice() {
            const storageDiv = document.getElementById('storage-advice');
            
            const storageAdvice = {
                "Wheat": "Cool, dry place with good ventilation. Temperature: 15-20°C, Humidity: Below 60%, Duration: Up to 2 years",
                "Rice": "Cool, dry, well-ventilated area. Temperature: 10-15°C, Humidity: Below 50%, Duration: Up to 1 year",
                "Maize": "Dry, well-ventilated storage. Temperature: Below 20°C, Humidity: Below 60%, Duration: 6-12 months",
                "Chickpea": "Cool, dry place. Temperature: 10-20°C, Humidity: Below 60%, Duration: Up to 2 years",
                "Soybean": "Cool, dry, well-ventilated. Temperature: Below 20°C, Humidity: Below 60%, Duration: 6-12 months"
            };

            let storageHTML = '';
            Object.entries(storageAdvice).forEach(([crop, advice]) => {
                storageHTML += `<div class="crop-card"><h4>${crop}</h4><p>${advice}</p></div>`;
            });
            
            storageDiv.innerHTML = storageHTML;
        }

        function generateConclusion() {
            const conclusionDiv = document.getElementById('conclusion');
            const lang = document.getElementById('language').value;
            const t = translations[lang];
            
            const conclusionHTML = `
                <div class="success">
                    <h4>🎉 Your personalized crop diversification plan is ready!</h4>
                    <p>Follow these recommendations for optimal results.</p>
                </div>
                
                <div class="info-box">
                    <h4>🌾 ${t['diversification-benefits-title']}</h4>
                    <p><strong>${t['diversification-benefits-text']}</strong></p>
                </div>
                
                <h4>Action Items:</h4>
                <ol>
                    <li>Prepare your fields according to the recommended crop layout</li>
                    <li>Monitor weather conditions and take necessary precautions</li>
                    <li>Follow storage guidelines for each crop after harvest</li>
                    <li>Implement disease prevention measures as suggested</li>
                    <li>Regular soil testing to maintain optimal conditions</li>
                </ol>
                
                <h4>Next Steps:</h4>
                <ul>
                    <li><strong>Week 1-2:</strong> Field preparation and soil conditioning</li>
                    <li><strong>Week 3-4:</strong> Planting according to recommended schedule</li>
                    <li><strong>Ongoing:</strong> Monitor crop health and weather conditions</li>
                    <li><strong>Harvest:</strong> Follow storage recommendations for each crop</li>
                </ul>
            `;
            
            conclusionDiv.innerHTML = conclusionHTML;
        }

        // Database simulation (in real app, this would connect to actual database)
        const farmerDatabase = {
            farmers: [],
            cropSelections: [],
            marketPrices: [],
            farmingPlans: [],
            farmLayouts: [],
            
            addFarmer: function(farmerData) {
                const farmer = {
                    id: this.farmers.length + 1,
                    ...farmerData,
                    createdAt: new Date().toISOString()
                };
                this.farmers.push(farmer);
                return farmer.id;
            },
            
            addCropSelection: function(farmerId, cropData) {
                const selection = {
                    id: this.cropSelections.length + 1,
                    farmerId: farmerId,
                    ...cropData,
                    selectedAt: new Date().toISOString()
                };
                this.cropSelections.push(selection);
            },
            
            addMarketPrice: function(region, district, cropName, pricePerTon, source = "Manual Entry") {
                const price = {
                    id: this.marketPrices.length + 1,
                    region: region,
                    district: district,
                    cropName: cropName,
                    pricePerTon: pricePerTon,
                    priceDate: new Date().toISOString().split('T')[0],
                    source: source,
                    createdAt: new Date().toISOString()
                };
                this.marketPrices.push(price);
            },
            
            getMarketPrices: function(region, district, cropName, days = 30) {
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                return this.marketPrices.filter(price => {
                    const priceDate = new Date(price.priceDate);
                    return priceDate >= cutoffDate &&
                           (!region || price.region === region) &&
                           (!district || price.district === district) &&
                           (!cropName || price.cropName === cropName);
                });
            },
            
            getMarketTrends: function(region, district, cropName) {
                const prices = this.getMarketPrices(region, district, cropName, 90);
                
                if (prices.length === 0) {
                    return { trend: 'no_data', averagePrice: 0, priceChange: 0 };
                }
                
                const latestPrice = prices[0].pricePerTon;
                const oldestPrice = prices[prices.length - 1].pricePerTon;
                const averagePrice = prices.reduce((sum, p) => sum + p.pricePerTon, 0) / prices.length;
                
                const priceChange = oldestPrice > 0 ? ((latestPrice - oldestPrice) / oldestPrice) * 100 : 0;
                const trend = priceChange > 5 ? 'up' : priceChange < -5 ? 'down' : 'stable';
                
                return {
                    trend: trend,
                    averagePrice: Math.round(averagePrice * 100) / 100,
                    priceChange: Math.round(priceChange * 100) / 100,
                    latestPrice: latestPrice,
                    dataPoints: prices.length
                };
            }
        };

        // Initialize sample market data
        function initializeSampleMarketData() {
            const regions = ['Karnataka', 'Maharashtra', 'Tamil Nadu', 'Andhra Pradesh'];
            const districts = {
                'Karnataka': ['Bangalore Urban', 'Mysore', 'Belgaum', 'Hubli-Dharwad'],
                'Maharashtra': ['Pune', 'Nagpur', 'Nashik', 'Mumbai'],
                'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai', 'Tiruchirappalli'],
                'Andhra Pradesh': ['Hyderabad', 'Vijayawada', 'Visakhapatnam', 'Guntur']
            };
            const crops = ['Rice', 'Wheat', 'Maize', 'Cotton', 'Sugarcane', 'Groundnut', 'Soybean'];
            
            regions.forEach(region => {
                districts[region].forEach(district => {
                    crops.forEach(crop => {
                        const basePrice = Math.floor(Math.random() * 40000) + 20000;
                        for (let daysAgo = 0; daysAgo < 30; daysAgo++) {
                            const priceDate = new Date();
                            priceDate.setDate(priceDate.getDate() - daysAgo);
                            const priceVariation = 0.8 + Math.random() * 0.4;
                            const price = Math.round(basePrice * priceVariation);
                            
                            farmerDatabase.addMarketPrice(region, district, crop, price, "Sample Data");
                        }
                    });
                });
            });
        }

        // Initialize the page
        changeLanguage();
        initializeSampleMarketData();
        
        // Function to auto-fill form from detected location
        function autoFillFromDetectedLocation(locationData) {
            const lat = locationData.latitude;
            const lon = locationData.longitude;
            
            // Check if we should show results immediately (from Hackathon.html)
            if (locationData.autoShowResults) {
                // Automatically trigger auto-detection mode and show results
                selectPlanningMode('auto');
                setTimeout(() => {
                    performLocationDetection();
                }, 500);
                return;
            }
            
            // Find closest agricultural data based on coordinates
            const agriculturalInfo = findClosestAgriculturalData(lat, lon);
            
            if (agriculturalInfo) {
                // Auto-fill the form with detected data
                autoFillForm(agriculturalInfo);
                
                // Switch to manual mode to show the filled form
                switchToManualMode();
                
                // Show the filled form immediately
                document.getElementById('manual-planning-interface').style.display = 'block';
                document.getElementById('planning-mode-selection').style.display = 'none';
                
                console.log('Form auto-filled with agricultural data for:', agriculturalInfo.region);
            } else {
                console.log('No agricultural data found for coordinates:', lat, lon);
                showWarningMessage('⚠️ Location detected but no agricultural data available for your area. Please fill the form manually.');
            }
        }
        
        // Add event listeners
        document.getElementById('language').addEventListener('change', changeLanguage);
        
        // Initialize the primary interface
        window.addEventListener('load', function() {
            // Check if location data was passed from Hackathon.html
            const storedLocation = localStorage.getItem('detectedLocation');
            if (storedLocation) {
                try {
                    const locationData = JSON.parse(storedLocation);
                    console.log('Location data received:', locationData);
                    
                    // Auto-fill the form with detected location data
                    autoFillFromDetectedLocation(locationData);
                    
                    // Clear the stored location data to avoid reusing it
                    localStorage.removeItem('detectedLocation');
                    
                    // Show success message
                    showSuccessMessage('✅ Location data loaded from previous detection! Form auto-filled with your area information.');
                } catch (error) {
                    console.error('Error parsing location data:', error);
                }
            }
            
            // Show the primary interface by default
            document.getElementById('planning-mode-selection').style.display = 'block';
            document.getElementById('auto-detection-interface').style.display = 'none';
            document.getElementById('manual-planning-interface').style.display = 'none';
            
            // Add region change listener when manual interface is loaded
            setTimeout(() => {
                const regionSelect = document.getElementById('region');
                if (regionSelect) {
                    regionSelect.addEventListener('change', handleRegionChange);
                }
            }, 100);
        });
        
        // Custom Dropdown Functionality
        function createCustomDropdown(selectElement) {
            const dropdown = document.createElement('div');
            dropdown.className = 'custom-dropdown';
            if (selectElement.disabled) {
                dropdown.classList.add('disabled');
            }
            
            const toggle = document.createElement('div');
            toggle.className = 'custom-dropdown-toggle';
            toggle.tabIndex = selectElement.disabled ? -1 : 0;
            
            const selectedText = document.createElement('span');
            selectedText.className = 'custom-dropdown-text';
            selectedText.textContent = selectElement.options[selectElement.selectedIndex]?.textContent || 'Please select';
            
            const arrow = document.createElement('div');
            arrow.className = 'custom-dropdown-arrow';
            arrow.innerHTML = '▼';
            
            toggle.appendChild(selectedText);
            toggle.appendChild(arrow);
            
            const menu = document.createElement('div');
            menu.className = 'custom-dropdown-menu';
            
            // Create options
            Array.from(selectElement.options).forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'custom-dropdown-option';
                optionElement.textContent = option.textContent;
                optionElement.dataset.value = option.value;
                
                if (option.selected) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.addEventListener('click', () => {
                    // Update selected option
                    menu.querySelectorAll('.custom-dropdown-option').forEach(opt => opt.classList.remove('selected'));
                    optionElement.classList.add('selected');
                    
                    // Update display text
                    selectedText.textContent = option.textContent;
                    
                    // Update original select
                    selectElement.selectedIndex = index;
                    selectElement.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    // Close dropdown
                    dropdown.classList.remove('open');
                });
                
                menu.appendChild(optionElement);
            });
            
            dropdown.appendChild(toggle);
            dropdown.appendChild(menu);
            
            // Toggle functionality
            toggle.addEventListener('click', (e) => {
                if (selectElement.disabled) return;
                e.stopPropagation();
                dropdown.classList.toggle('open');
            });
            
            // Keyboard support
            toggle.addEventListener('keydown', (e) => {
                if (selectElement.disabled) return;
                
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    dropdown.classList.toggle('open');
                } else if (e.key === 'Escape') {
                    dropdown.classList.remove('open');
                }
            });
            
            // Close on outside click
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('open');
                }
            });
            
            return dropdown;
        }
        
        // Initialize custom dropdowns
        function initializeCustomDropdowns() {
            const selectElements = document.querySelectorAll('select');
            selectElements.forEach(select => {
                const customDropdown = createCustomDropdown(select);
                select.parentNode.insertBefore(customDropdown, select);
                select.style.display = 'none'; // Hide original select
            });
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeCustomDropdowns);
        } else {
            initializeCustomDropdowns();
        }
    </script>
    </main>
</body>
</html>
